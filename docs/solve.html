<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resolver Ejercicio - Data Engineering Hub</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/solve.css">
</head>
<body class="solve-page">
    <header class="solve-header">
        <div class="container">
            <div class="header-top">
                <button onclick="goBack()" class="back-button">â† Volver</button>
                <h1 id="exercise-title">Cargando ejercicio...</h1>
            </div>
            <div class="exercise-info">
                <span id="exercise-category" class="exercise-category"></span>
                <span id="exercise-difficulty" class="difficulty-badge"></span>
                <span class="timer-display">
                    â±ï¸ <span id="timer">00:00</span> / <span id="time-limit">00:00</span>
                </span>
            </div>
        </div>
    </header>

    <main class="solve-container">
        <div class="left-panel">
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchLeftTab('problem')" data-tab="problem">
                    <span class="tab-icon">ğŸ“‹</span>
                    <span class="tab-label">Problema</span>
                </button>
                <button class="tab-btn" onclick="switchLeftTab('knowledge')" data-tab="knowledge" id="knowledge-tab-btn" style="display: none;">
                    <span class="tab-icon">ğŸ“š</span>
                    <span class="tab-label">TeorÃ­a</span>
                </button>
                <button class="tab-btn" onclick="switchLeftTab('examples')" data-tab="examples" id="examples-tab-btn" style="display: none;">
                    <span class="tab-icon">ğŸ“</span>
                    <span class="tab-label">Ejemplos</span>
                </button>
                <button class="tab-btn" onclick="switchLeftTab('hints')" data-tab="hints">
                    <span class="tab-icon">ğŸ’¡</span>
                    <span class="tab-label">Pistas</span>
                    <span class="hints-badge" id="hints-badge">3</span>
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content-container">
                <!-- Problem Tab -->
                <div class="tab-content active" id="tab-problem">
                    <div class="content-header">
                        <h2>ğŸ“‹ DescripciÃ³n del Problema</h2>
                    </div>
                    <div id="problem-description" class="content-text">
                        Cargando...
                    </div>

                    <div class="content-header">
                        <h2>ğŸ“– Instrucciones</h2>
                    </div>
                    <div id="problem-instructions" class="content-text instructions-list">
                        Cargando...
                    </div>

                    <div class="dataset-card">
                        <div class="dataset-card-header">
                            <span class="dataset-icon">ğŸ“Š</span>
                            <span class="dataset-title">Dataset: <strong id="dataset-name">dataset.csv</strong></span>
                        </div>
                        <button onclick="viewDataset()" class="btn-dataset">
                            <span>ğŸ‘ï¸</span> Ver Datos Completos
                        </button>
                    </div>

                    <div class="test-cases-compact">
                        <h3>âœ“ Casos de Prueba</h3>
                        <div id="test-cases-list">
                            <!-- Test cases will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Knowledge Tab -->
                <div class="tab-content" id="tab-knowledge" style="display: none;">
                    <div class="content-header">
                        <h2>ğŸ“š Conocimiento TeÃ³rico</h2>
                        <p class="content-subtitle">Conceptos necesarios para resolver este ejercicio</p>
                    </div>
                    <div id="knowledge-content" class="knowledge-cards">
                        <!-- Knowledge will be loaded here -->
                    </div>
                </div>

                <!-- Examples Tab -->
                <div class="tab-content" id="tab-examples" style="display: none;">
                    <div class="content-header">
                        <h2>ğŸ“ Ejemplos de Input/Output</h2>
                        <p class="content-subtitle">Observa cÃ³mo deberÃ­a funcionar tu soluciÃ³n</p>
                    </div>
                    <div id="examples-content" class="examples-cards">
                        <!-- Examples will be loaded here -->
                    </div>
                </div>

                <!-- Hints Tab -->
                <div class="tab-content" id="tab-hints" style="display: none;">
                    <div class="content-header">
                        <h2>ğŸ’¡ Pistas Progresivas</h2>
                        <p class="content-subtitle">Ãšsalas con sabidurÃ­a - de mÃ¡s general a mÃ¡s especÃ­fica</p>
                    </div>
                    <div class="hints-info">
                        <div class="hints-counter">
                            <span class="hints-available" id="hints-remaining-display">3</span>
                            <span class="hints-label">pistas disponibles</span>
                        </div>
                    </div>
                    <div id="hints-content" class="hints-list">
                        <!-- Hints will be loaded here -->
                        <div class="hints-empty">
                            <p>Click el botÃ³n para revelar la primera pista</p>
                        </div>
                    </div>
                    <button onclick="revealNextHint()" class="btn-reveal-hint" id="reveal-hint-btn">
                        ğŸ”“ Revelar Siguiente Pista
                    </button>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="editor-section">
                <div class="editor-header">
                    <h2>Editor de CÃ³digo</h2>
                    <div class="editor-controls">
                        <button id="reset-code" class="btn-secondary" onclick="resetCode()">
                            ğŸ”„ Reset
                        </button>
                        <button id="run-code" class="btn-primary" onclick="runCode()">
                            â–¶ï¸ Ejecutar
                        </button>
                    </div>
                </div>
                <div id="code-editor" class="code-editor-container"></div>
            </div>

            <div class="output-section">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('output')">Salida</button>
                    <button class="tab" onclick="switchTab('console')">Consola</button>
                    <button class="tab" onclick="switchTab('results')">Resultados</button>
                </div>
                <div id="output-content" class="output-content">
                    <div class="placeholder">
                        Ejecuta tu cÃ³digo para ver los resultados aquÃ­
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Modal -->
    <div id="loading-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="loader"></div>
            <p>Ejecutando cÃ³digo...</p>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="results-modal" class="modal" style="display: none;">
        <div class="modal-content results-modal">
            <h2 id="results-title">Resultados</h2>
            <div id="results-content"></div>
            <div class="modal-actions">
                <button onclick="closeResultsModal()" class="btn-primary">Cerrar</button>
                <button onclick="goBack()" class="btn-secondary">Volver al Inicio</button>
            </div>
        </div>
    </div>

    <!-- Hint Modal -->
    <div id="hint-modal" class="modal" style="display: none;">
        <div class="modal-content hint-modal">
            <div class="modal-header">
                <h2>ğŸ’¡ Pista <span id="current-hint-number"></span></h2>
                <button onclick="closeHintModal()" class="close-btn">âœ•</button>
            </div>
            <div id="hint-content" class="hint-content">
                <!-- Hint will be loaded here -->
            </div>
            <div class="modal-actions">
                <button onclick="closeHintModal()" class="btn-primary">Entendido</button>
                <button onclick="showHint()" class="btn-secondary" id="next-hint-btn">
                    Siguiente Pista (<span id="hints-remaining-modal">2</span>)
                </button>
            </div>
        </div>
    </div>

    <!-- Dataset Modal -->
    <div id="dataset-modal" class="modal" style="display: none;">
        <div class="modal-content dataset-modal">
            <div class="modal-header">
                <h2>ğŸ“Š Dataset: <span id="dataset-modal-name"></span></h2>
                <button onclick="closeDatasetModal()" class="close-btn">âœ•</button>
            </div>
            <div class="dataset-info-text">
                <p><strong>Filas:</strong> <span id="dataset-rows">0</span> | <strong>Columnas:</strong> <span id="dataset-cols">0</span></p>
            </div>
            <div id="dataset-content" class="dataset-content">
                <!-- Dataset table will be loaded here -->
            </div>
            <div class="modal-actions">
                <button onclick="closeDatasetModal()" class="btn-primary">Cerrar</button>
                <button onclick="downloadDataset()" class="btn-secondary">â¬‡ï¸ Descargar CSV</button>
            </div>
        </div>
    </div>

    <!-- AI Assistant -->
    <div id="ai-assistant-container" class="ai-assistant-container">
        <button id="ai-toggle-btn" class="ai-toggle-btn" onclick="toggleAIAssistant()">
            ğŸ¤– AI Asistente
        </button>

        <div id="ai-chat-panel" class="ai-chat-panel" style="display: none;">
            <div class="ai-chat-header">
                <span>ğŸ¤– AI Asistente - Gemini</span>
                <div>
                    <button onclick="openAISettings()" class="ai-btn-icon" title="ConfiguraciÃ³n">âš™ï¸</button>
                    <button onclick="clearAIChat()" class="ai-btn-icon" title="Limpiar chat">ğŸ—‘ï¸</button>
                    <button onclick="toggleAIAssistant()" class="ai-btn-icon">âœ•</button>
                </div>
            </div>

            <div id="ai-chat-messages" class="ai-chat-messages">
                <div class="ai-message ai-message-system">
                    ğŸ‘‹ Â¡Hola! Soy tu asistente de IA. Puedo ayudarte con:
                    <ul>
                        <li>Explicar errores en tu cÃ³digo</li>
                        <li>Dar hints sin revelar la soluciÃ³n</li>
                        <li>Aclarar conceptos de programaciÃ³n</li>
                        <li>Sugerir mejores prÃ¡cticas</li>
                    </ul>
                    <small style="opacity: 0.7;">ğŸ’¡ Tip: Haz preguntas especÃ­ficas para mejores respuestas</small>
                </div>
            </div>

            <div class="ai-chat-input-container">
                <div class="ai-quick-actions">
                    <button onclick="askAI('Explica el error que tengo')" class="ai-quick-btn">ğŸ› Explicar error</button>
                    <button onclick="askAI('Dame una pista para resolver esto')" class="ai-quick-btn">ğŸ’¡ Dame pista</button>
                    <button onclick="askAI('Â¿QuÃ© concepto debo usar aquÃ­?')" class="ai-quick-btn">ğŸ“š Conceptos</button>
                </div>
                <div class="ai-input-row">
                    <input
                        type="text"
                        id="ai-chat-input"
                        class="ai-chat-input"
                        placeholder="Pregunta algo... (Enter para enviar)"
                        onkeypress="handleAIChatKeyPress(event)"
                    />
                    <button onclick="sendAIMessage()" class="ai-send-btn">Enviar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Settings Modal -->
    <div id="ai-settings-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>âš™ï¸ ConfiguraciÃ³n de IA</h2>
                <button onclick="closeAISettings()" class="close-btn">âœ•</button>
            </div>
            <div style="padding: 1.5rem;">
                <h3 style="margin-bottom: 1rem;">Gemini API Key</h3>
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                    Para usar el asistente de IA, necesitas una API key de Google Gemini (gratuita).
                </p>

                <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <strong>CÃ³mo obtener tu API key:</strong>
                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Ve a <a href="https://aistudio.google.com/apikey" target="_blank" style="color: var(--primary-color);">Google AI Studio</a></li>
                        <li>Inicia sesiÃ³n con tu cuenta Google</li>
                        <li>Click en "Get API Key" â†’ "Create API key"</li>
                        <li>Copia la key y pÃ©gala abajo</li>
                    </ol>
                </div>

                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                    Tu API Key:
                </label>
                <input
                    type="password"
                    id="ai-api-key-input"
                    placeholder="AIza..."
                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; font-family: monospace;"
                />

                <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
                    ğŸ”’ Tu API key se guarda localmente en tu navegador. No la compartimos.
                </div>

                <div id="ai-key-status" style="margin-top: 1rem; padding: 0.75rem; border-radius: 4px; display: none;"></div>
            </div>
            <div class="modal-actions">
                <button onclick="saveAISettings()" class="btn-primary">ğŸ’¾ Guardar</button>
                <button onclick="removeAIKey()" class="btn-secondary">ğŸ—‘ï¸ Eliminar Key</button>
            </div>
        </div>
    </div>

    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script src="js/ai-assistant.js"></script>
    <script src="js/solve.js"></script>
</body>
</html>
